<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Magic Tiles - Jeu avec musique</title>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #111;
      color: #fff;
      font-family: sans-serif;
    }
    #game {
      position: relative;
      width: 300px;
      height: 500px;
      background: #222;
      overflow: hidden;
      border-radius: 10px;
    }
    .tile {
      position: absolute;
      width: 70px;
      height: 70px;
      border-radius: 5px;
      cursor: pointer;
    }
    #scoreLives {
      margin-bottom: 10px;
      text-align: center;
      font-size: 16px;
    }
    #startBtn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #1abc9c;
      color: #042;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<div id="scoreLives">Score: <span id="score">0</span> | Vies: <span id="lives">3</span></div>
<button id="startBtn">DÃ©marrer le jeu</button>
<div id="game"></div>

<script>
  const game = document.getElementById('game');
  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const startBtn = document.getElementById('startBtn');

  let tiles = [];
  let score = 0;
  let lives = 3;
  let gameInterval;
  let spawnInterval = 1000;
  let tileSpeed = 2;

  // MUSIQUE
  const audio = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
  audio.loop = true;

  function spawnTile() {
    const tile = document.createElement('div');
    tile.classList.add('tile');
    const colors = ['#e74c3c','#3498db','#f1c40f','#9b59b6'];
    tile.style.background = colors[Math.floor(Math.random()*colors.length)];
    const x = Math.floor(Math.random() * 4) * 75 + 5;
    tile.style.left = x + 'px';
    tile.style.top = '-80px';
    game.appendChild(tile);
    tiles.push(tile);

    tile.addEventListener('click', () => {
      score += 10;
      scoreEl.textContent = score;
      tile.remove();
      tiles.splice(tiles.indexOf(tile),1);
    });

    function move() {
      if (!tile.parentElement) return;
      const top = parseFloat(tile.style.top);
      if (top > game.clientHeight) {
        tile.remove();
        tiles.splice(tiles.indexOf(tile),1);
        lives -= 1;
        livesEl.textContent = lives;
        if (lives <= 0) { endGame(); return; }
        return;
      }
      tile.style.top = top + tileSpeed + 'px';
      requestAnimationFrame(move);
    }
    requestAnimationFrame(move);
  }

  function startGame() {
    startBtn.style.display = 'none';
    
    // Lecture musique avec gestion blocage navigateur
    audio.play().catch(() => {
      document.body.addEventListener('click', () => audio.play(), { once: true });
    });

    score = 0;
    lives = 3;
    scoreEl.textContent = score;
    livesEl.textContent = lives;
    gameInterval = setInterval(spawnTile, spawnInterval);
  }

  function endGame() {
    clearInterval(gameInterval);
    audio.pause();
    alert('GAME OVER\nScore: ' + score);
    tiles.forEach(t => t.remove());
    tiles = [];
    startBtn.style.display = 'inline-block';
  }

  startBtn.addEventListener('click', startGame);
</script>

</body>
</html>
